# ä¸ªäººæœåŠ¡å™¨éƒ¨ç½²å®Œæ•´æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ä¸ªäºº VPS ä¸Šç¨³å®šéƒ¨ç½² SmartGrader V2ï¼Œç¡®ä¿æœåŠ¡æŒç»­è¿è¡Œä¸ä¼šä¸­æ–­ã€‚

## ğŸ“‹ å‰ç½®æ¡ä»¶

- ä¸€å° VPS æœåŠ¡å™¨ï¼ˆå·²å®‰è£… Node.js 16+ å’Œ Gitï¼‰
- SSH è®¿é—®æƒé™
- æœåŠ¡å™¨è‡³å°‘æœ‰ 1GB å¯ç”¨å†…å­˜

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆæ¨èï¼‰

### 1. ç™»å½•æœåŠ¡å™¨å¹¶å…‹éš†é¡¹ç›®

```bash
# SSH ç™»å½•æ‚¨çš„æœåŠ¡å™¨
ssh user@107.172.32.153

# å…‹éš†é¡¹ç›®ï¼ˆå¦‚æœå·²ç»å…‹éš†åˆ™è·³è¿‡ï¼‰
cd ~
git clone <your-repo-url> smartgrader-v2
cd smartgrader-v2
```

### 2. ä¸€é”®éƒ¨ç½²

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x deploy.sh

# æ‰§è¡Œéƒ¨ç½²è„šæœ¬
bash deploy.sh
```

è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆä»¥ä¸‹æ“ä½œï¼š
- âœ… å®‰è£… PM2ï¼ˆè¿›ç¨‹ç®¡ç†å™¨ï¼‰
- âœ… æ‹‰å–æœ€æ–°ä»£ç 
- âœ… å®‰è£…ä¾èµ–
- âœ… æ„å»ºé¡¹ç›®
- âœ… å¯åŠ¨æœåŠ¡ï¼ˆä½¿ç”¨ PM2 å®ˆæŠ¤ï¼‰
- âœ… é…ç½®å¼€æœºè‡ªå¯

### 3. é…ç½®é˜²ç«å¢™

**äº‘æœåŠ¡å•†æ§åˆ¶å°ï¼ˆå¿…é¡»ï¼‰ï¼š**
1. ç™»å½•æ‚¨çš„äº‘æœåŠ¡å•†ç®¡ç†åå°ï¼ˆRackNerd / AWS / è…¾è®¯äº‘ç­‰ï¼‰
2. æ‰¾åˆ°ã€Œå®‰å…¨ç»„ã€æˆ–ã€Œé˜²ç«å¢™ã€è®¾ç½®
3. æ·»åŠ è§„åˆ™ï¼šå…è®¸ **TCP 23456** ç«¯å£å…¥ç«™è®¿é—®

**æœåŠ¡å™¨é˜²ç«å¢™ï¼ˆå¦‚æœå¯ç”¨äº†ï¼‰ï¼š**

```bash
# Ubuntu/Debian
sudo ufw allow 23456
sudo ufw reload

# CentOS/RHEL
sudo firewall-cmd --zone=public --add-port=23456/tcp --permanent
sudo firewall-cmd --reload
```

### 4. éªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs smartgrader-v2

# æµ‹è¯•è®¿é—®ï¼ˆæœåŠ¡å™¨å†…éƒ¨ï¼‰
curl http://127.0.0.1:23456
```

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨åº”è¯¥èƒ½çœ‹åˆ°æœåŠ¡è¿è¡Œä¸­ï¼Œå¹¶ä¸” curl è¿”å› HTML å†…å®¹ã€‚

### 5. å¤–éƒ¨è®¿é—®

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š`http://107.172.32.153:23456`

---

## ğŸ”§ å¸¸ç”¨ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 status

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs smartgrader-v2

# æŸ¥çœ‹ç›‘æ§é¢æ¿
pm2 monit

# é‡å¯æœåŠ¡
pm2 restart smartgrader-v2

# åœæ­¢æœåŠ¡
pm2 stop smartgrader-v2

# åˆ é™¤æœåŠ¡
pm2 delete smartgrader-v2

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 show smartgrader-v2
```

---

## â“ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: å‡ åˆ†é’ŸåæœåŠ¡å°±åœæ­¢äº†

**åŸå› **ï¼šæ‚¨å¯èƒ½ç›´æ¥åœ¨ SSH ç»ˆç«¯è¿è¡Œäº† `npm start`ï¼ŒSSH æ–­å¼€åè¿›ç¨‹è¢«æ€æ­»ã€‚

**è§£å†³**ï¼šä½¿ç”¨ PM2 è¿›ç¨‹ç®¡ç†å™¨ï¼ˆæŒ‰ç…§ä¸Šè¿°å¿«é€Ÿéƒ¨ç½²æ­¥éª¤æ“ä½œï¼‰ã€‚

### é—®é¢˜ 2: æ— æ³•ä»å¤–éƒ¨è®¿é—®

**æ’æŸ¥æ­¥éª¤**ï¼š

1. **æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ**
   ```bash
   pm2 status
   netstat -nutlp | grep 23456
   ```
   åº”è¯¥çœ‹åˆ°ç›‘å¬åœ°å€æ˜¯ `0.0.0.0:23456` æˆ– `:::23456`

2. **æœåŠ¡å™¨å†…éƒ¨æµ‹è¯•**
   ```bash
   curl http://127.0.0.1:23456
   ```
   åº”è¯¥è¿”å› HTML å†…å®¹

3. **æ£€æŸ¥é˜²ç«å¢™**
   - äº‘æœåŠ¡å•†æ§åˆ¶å°çš„å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾äº† 23456 ç«¯å£
   - æœåŠ¡å™¨æœ¬åœ°é˜²ç«å¢™æ˜¯å¦æ”¾è¡Œï¼ˆè§ä¸Šæ–‡é…ç½®é˜²ç«å¢™éƒ¨åˆ†ï¼‰

### é—®é¢˜ 3: å†…å­˜ä¸è¶³ï¼ˆOOMï¼‰

**ç°è±¡**ï¼šPM2 æ˜¾ç¤ºè¿›ç¨‹é¢‘ç¹é‡å¯ï¼Œæ—¥å¿—ä¸­æœ‰å†…å­˜ç›¸å…³é”™è¯¯ã€‚

**è§£å†³**ï¼š
```bash
# ç¼–è¾‘ ecosystem.config.jsï¼Œè°ƒæ•´å†…å­˜é™åˆ¶
# max_memory_restart: '512M'  # é™ä½åˆ° 512MB

# æˆ–è€…å‡çº§æœåŠ¡å™¨å¥—é¤
```

### é—®é¢˜ 4: ç«¯å£è¢«å ç”¨

**æ’æŸ¥**ï¼š
```bash
# æŸ¥çœ‹è°åœ¨å ç”¨ 23456 ç«¯å£
sudo lsof -i :23456

# æ€æ­»å ç”¨ç«¯å£çš„è¿›ç¨‹
sudo kill -9 <PID>
```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

å½“ä»£ç æœ‰æ›´æ–°æ—¶ï¼š

```bash
# ç™»å½•æœåŠ¡å™¨
ssh user@107.172.32.153
cd ~/smartgrader-v2

# é‡æ–°è¿è¡Œéƒ¨ç½²è„šæœ¬
bash deploy.sh
```

---

## ğŸŒ ä½¿ç”¨åŸŸåï¼ˆå¯é€‰ï¼‰

å¦‚æœæ‚¨æœ‰åŸŸåï¼Œå¯ä»¥é…ç½® Nginx åå‘ä»£ç†ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:23456;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

ç„¶åå°±å¯ä»¥é€šè¿‡ `http://your-domain.com` è®¿é—®ï¼Œæ— éœ€åŠ ç«¯å£å·ã€‚

---

## ğŸ“ è·å–æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. PM2 çŠ¶æ€ï¼š`pm2 status`
2. æ—¥å¿—å†…å®¹ï¼š`pm2 logs smartgrader-v2 --lines 50`
3. ç«¯å£ç›‘å¬ï¼š`netstat -nutlp | grep 23456`
4. æœåŠ¡å™¨å†…éƒ¨æµ‹è¯•ï¼š`curl -v http://127.0.0.1:23456`
